# 水位計の設定

ここまでで、Nahlundが配信する情報を地図アプリケーションから描画できるようになりました。
しかし、河川を確認しても、水面を表す情報がありません。

これは、Nahlundが水位計の情報を一つも持っていないためです。
ここでは、Nahlundに水位計の情報を登録し、計測された水位を登録する方法を説明します。

## 水位計の登録

水位計は以下のコマンドから登録できます。

```bash
curl -X POST -H "Content-Type: application/json" -d '{"altitude":<ALTITUDE>, "interval":<INTERVAL>, "scope":<SCOPE>, "parent_node":<PARENT_NODE>}' 'http://localhost:3001/api/sensors?id=<ID>'
```

各パラメータの意味は以下の通りです。

`<ALTITUDE>`
: 水位計の標高 [m]

`<INTERVAL>`
: 水位計の計測間隔
: 以下の数字のいずれかにする必要があります
: - 0 (インターバルなし)
: - 1 (2分)
: - 2 (5分)
: - 3 (10分)
: - 4 (20分)
: - 5 (30分)
: - 6 (60分)

`<SCOPE>`
: 水位計の値が描画する水面に影響を与える範囲 [m]
: あるノードにおける水位を計算する際、そのノードをスコープ内に含む水位計のデータを参照します。

`<PARENT_NODE>`
: 水位計を設置する河川ノードのID
: 水位計は指定したノードの座標に設置されたものとして扱われます。
: 河川ノードのIDは、[このページ](https://azishio.github.io/nahlun-nodeid-viewer/)から確認できます。

`<ID>`
: 水位計が一意に持つUUID

## 計測値の登録

本来は水位計が計測した値をNahlundに送信することで、Nahlundが水位計の情報を更新します。
ここでは、curlコマンドを使用して、水位計がNahlundに送信するリクエストを模擬します。

```bash
curl -X POST -H "Content-Type: application/json" -d '{"distance":<DISTANCE>, "battery_voltage":<VATTERY_VOLTAGE>, "previous_sleep_time":<PREVIOUS_SLEEP_TIME>, "network_status":<NETWORK_STATUS>}' 'http://localhost:3001/api/sensors/data?id=<ID>'
```

各パラメータの意味は以下の通りです。

`<DISTANCE>`
: 水位計から水面までの距離 [m]
: 水位は、水面までの距離を水位計の標高から引いた値として計算されます。

`<BATTERY_VOLTAGE>`
: 水位計の電池電圧 [mV]

`<PREVIOUS_SLEEP_TIME>`
: 水位計が前回の計測からスリープしていた時間。
: 以下の数字のいずれかになります。
: - 0 (インターバルなし)
: - 1 (2分)
: - 2 (5分)
: - 3 (10分)
: - 4 (20分)
: - 5 (30分)
: - 6 (60分)

`<NETWORK_STATUS>`
: 水位計のネットワーク接続状態

`<ID>`
: 水位計が一意に持つUUID

> `<VATTERY_VOLTAGE>`、`<NETWORK_STATUS>`は描画結果に影響を与えない管理情報です。
>
> 今回は`<VATTERY_VOLTAGE>`には適当な数値を、`<NETWORK_STATUS>`には適当な文字列を入力してください。


水位の情報をポストしてからしばらくすると、地図アプリケーションに水面が描画されるようになります。
これで、Nahlunを使用した基本的な地図アプリケーションが完成しました。
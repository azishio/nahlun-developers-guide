# 動作のカスタマイズ

Nahlundの動作は、`/etc/nahlund/`以下に存在する`neo4j.env`、`server.env`、`socketio.env`の3つの環境変数ファイルによってカスタマイズできます。

この環境変数は、それぞれNahlundが管理するコンテナに配布されます。

![環境変数の配布](nahlund-provide-env.drawio.svg)

## neo4j.env

デフォルトは以下のコマンドにより生成された環境変数です。`<size>`にはシステムが持つRAMの1/3が指定されます。

```console
docker run --rm neo4j:latest neo4j-admin server memory-recommendation --docker --memory=<size>
```

詳細は、[Memory recommendations - Operations Manual](https://neo4j.com/docs/operations-manual/current/tools/neo4j-admin/neo4j-admin-memrec/)
を参照してください。

> 一時的に作成されたコンテナ上で実行するため、データベースのサイズは0と表示されます。
> ```
> -- snip --
> 
> # The numbers below have been derived based on your current databases located at: '/var/lib/neo4j/data/databases'.
> # They can be used as an input into more detailed memory analysis.
> # Total size of lucene indexes in all databases: 0k
> # Total size of data and native indexes in all databases: 0k
> ```

> `NEO4J_AUTH`を設定しないでください。サービスが正常に動作しなくなります。
>
> 現時点で、Nahlunは固定されたユーザー名/パスワードでデータベースに接続しています。
> neo4jはコンテナネットワークにのみ公開されているため、外部からのアクセスは想定されていません。
>
{style="warning"}

## server.env

ADDR
: 水位計のデータ登録や、3Dモデルの配信等をするWebサーバーのアドレスとポートを指定します。
: デフォルトは`http://localhost:8080`です。

DISK_CACHE_MAX_SIZE
: 生成されたデータを一時的に保存するディスクキャッシュの最大サイズを指定します。
: デフォルトは`10GB`です。

MEMORY_CACHE_MAX_SIZE
: 生成されたデータを一時的に保存するメモリキャッシュの最大サイズを指定します。
: デフォルトはインストールしたシステムが持つRAMの1/4です。

## socketio.env

ADDR
: タイルの更新情報を配信するためのWebSocketサーバーのアドレスとポートを指定します。
: デフォルトは`http://localhost:3000`です。